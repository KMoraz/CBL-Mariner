From 07b9768cef6a224d256358c404c6ed5622d8acce Mon Sep 17 00:00:00 2001
From: Stefan Eissing <icing@apache.org>
Date: Thu, 16 Dec 2021 11:15:47 +0000
Subject: [PATCH] Merge r1895970 from trunk:

  *) mod_lua: Improve error handling



git-svn-id: https://svn.apache.org/repos/asf/httpd/httpd/branches/2.4.x@1896039 13f79535-47bb-0310-9956-ffa450edef68
---
 modules/lua/lua_request.c | 1 +
 1 file changed, 1 insertion(+)

diff --git a/modules/lua/lua_request.c b/modules/lua/lua_request.c
index 67ff432e51f..493b2bb431c 100644
--- a/modules/lua/lua_request.c
+++ b/modules/lua/lua_request.c
@@ -410,6 +410,7 @@ static int req_parsebody(lua_State *L)
             if (end == NULL) break;
             key = (char *) apr_pcalloc(r->pool, 256);
             filename = (char *) apr_pcalloc(r->pool, 256);
+            if (end - crlf <= 8) break;
             vlen = end - crlf - 8;
             buffer = (char *) apr_pcalloc(r->pool, vlen+1);
             memcpy(buffer, crlf + 4, vlen);
